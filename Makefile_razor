#
# Top-level OCCAM razor Makefile
#

ifneq (,)
This Makefile requires GNU Make.
endif

PROTOC = $(shell which protoc)
PYLINT = $(shell which pylint)
PIP    = $(shell which pip)

all: sanity_check proto

#
# Sanity Checks (do not really need protoc if we add the generated code to the repo).
#
sanity_check:  occam_home protoc

occam_home:
ifeq ($(OCCAM_HOME),)
	$(error OCCAM_HOME is undefined)
endif

protoc:
ifeq ($(PROTOC),)
	$(error google protobuffer compiler "protoc" required)
endif


proto:
	mkdir -p razor/proto
	touch razor/proto/__init__.py	      
	$(PROTOC) --proto_path=src --python_out=razor/proto src/Previrt.proto

#iam: local editable install of razor for developing
develop: 
ifeq ($(PROTOC),)
	$(error developing requires pip)
endif
	$(PIP) install -e .


lint:
ifeq ($(PYLINT),)
	$(error lint target requires pylint)
endif
	@ $(PYLINT) -E razor/*.py





clean:
	rm -rf razor/proto


